
Database             Time                 Version
-------------------- -------------------- ------------------------------
Start: ORCL          24-MAR-2020 11:38:03 Version 19.3.0.0.0


PL/SQL procedure successfully completed.


Table truncated.


99 rows created.


PL/SQL procedure successfully completed.

old   2:   :N_BINS := &1;
new   2:   :N_BINS := 3;

PL/SQL procedure successfully completed.

Running for N_BINS value of...

    N_BINS
----------
         3

Queries
POS 3 bins

ITEM_NAME              BIN ITEM_VALUE  BIN_TOTAL
--------------- ---------- ---------- ----------
Item-42                  2         98       1673
Item-76                  3         98       1638
Item-12                  1         97       1602
Item-41                  2         95       1673
Item-91                  3         95       1638
Item-74                  1         92       1602
Item-77                  3         91       1638
Item-8                   2         91       1673
Item-11                  2         90       1673
Item-23                  1         90       1602
Item-32                  3         89       1638
Item-6                   1         88       1602
Item-99                  2         87       1673
Item-53                  3         86       1638
Item-68                  2         82       1673
Item-62                  1         82       1602
Item-63                  3         80       1638
Item-70                  1         79       1602
Item-18                  2         78       1673
Item-22                  3         76       1638
Item-73                  1         76       1602
Item-40                  1         75       1602
Item-47                  3         75       1638
Item-29                  2         75       1673
Item-89                  2         75       1673
Item-65                  3         73       1638
Item-36                  1         72       1602
Item-92                  2         71       1673
Item-75                  3         69       1638
Item-67                  1         68       1602
Item-96                  3         68       1638
Item-55                  2         68       1673
Item-25                  1         66       1602
Item-83                  3         65       1638
Item-78                  2         65       1673
Item-20                  1         64       1602
Item-84                  1         61       1602
Item-59                  3         61       1638
Item-1                   2         61       1673
Item-82                  3         60       1638
Item-16                  2         60       1673
Item-38                  1         58       1602
Item-28                  2         56       1673
Item-51                  3         55       1638
Item-81                  2         54       1673
Item-37                  1         54       1602
Item-19                  3         53       1638
Item-21                  1         51       1602
Item-58                  3         49       1638
Item-85                  2         49       1673
Item-5                   1         48       1602
Item-14                  1         47       1602
Item-35                  3         47       1638
Item-10                  2         47       1673
Item-45                  2         47       1673
Item-50                  3         46       1638
Item-7                   1         46       1602
Item-49                  2         45       1673
Item-64                  3         44       1638
Item-3                   1         44       1602
Item-15                  2         43       1673
Item-93                  3         40       1638
Item-43                  1         40       1602
Item-88                  2         39       1673
Item-66                  3         37       1638
Item-31                  2         36       1673
Item-39                  1         36       1602
Item-97                  1         35       1602
Item-17                  3         35       1638
Item-71                  2         35       1673
Item-33                  1         30       1602
Item-72                  3         30       1638
Item-30                  2         30       1673
Item-13                  3         28       1638
Item-56                  2         26       1673
Item-34                  1         26       1602
Item-60                  3         23       1638
Item-95                  2         19       1673
Item-54                  1         19       1602
Item-61                  3         17       1638
Item-94                  1         16       1602
Item-46                  3         15       1638
Item-87                  2         15       1673
Item-9                   1         14       1602
Item-57                  3         10       1638
Item-80                  2         10       1673
Item-52                  2          9       1673
Item-79                  1          9       1602
Item-90                  1          8       1602
Item-26                  3          8       1638
Item-98                  2          8       1673
Item-4                   3          6       1638
Item-44                  1          5       1602
Item-27                  3          5       1638
Item-69                  2          5       1673
Item-86                  1          4       1602
Item-48                  3          4       1638
Item-24                  2          4       1673
Item-2                   1          2       1602

99 rows selected.

Elapsed: 00:00:00.05
SQL_ID  00s7w5kf0x4td, child number 0
-------------------------------------
WITH items_desc AS (        SELECT item_name, item_value,
Mod (Row_Number () OVER (ORDER BY item_value DESC), :N_BINS) + 1 bin
FROM items ) SELECT /*+ gather_plan_statistics XPOS */
item_name, bin, item_value, Sum (item_value) OVER (PARTITION BY bin)
bin_total   FROM items_desc  ORDER BY item_value DESC
Plan hash value: 3874413825
--------------------------------------------------------------------------------------------------------------------
| Id  | Operation             | Name  | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
--------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT      |       |      1 |        |     99 |00:00:00.01 |       7 |       |       |          |
|   1 |  SORT ORDER BY        |       |      1 |     99 |     99 |00:00:00.01 |       7 | 70656 | 70656 |63488  (0)|
|   2 |   WINDOW SORT         |       |      1 |     99 |     99 |00:00:00.01 |       7 |  9216 |  9216 | 8192  (0)|
|   3 |    VIEW               |       |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
|   4 |     WINDOW SORT       |       |      1 |     99 |     99 |00:00:00.01 |       7 |  9216 |  9216 | 8192  (0)|
|   5 |      TABLE ACCESS FULL| ITEMS |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
--------------------------------------------------------------------------------------------------------------------

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.16
PLF Items_Binned

ITEM_NAME              BIN ITEM_VALUE  BIN_VALUE
--------------- ---------- ---------- ----------
Item-42                  1         98       1638
Item-76                  2         98       1637
Item-12                  3         97       1638
Item-91                  1         95       1638
Item-41                  3         95       1638
Item-74                  2         92       1637
Item-77                  3         91       1638
Item-8                   2         91       1637
Item-11                  2         90       1637
Item-23                  1         90       1638
Item-32                  1         89       1638
Item-6                   3         88       1638
Item-99                  2         87       1637
Item-53                  3         86       1638
Item-68                  1         82       1638
Item-62                  1         82       1638
Item-63                  3         80       1638
Item-70                  2         79       1637
Item-18                  1         78       1638
Item-73                  3         76       1638
Item-22                  2         76       1637
Item-40                  1         75       1638
Item-47                  3         75       1638
Item-29                  2         75       1637
Item-89                  2         75       1637
Item-65                  3         73       1638
Item-36                  1         72       1638
Item-92                  1         71       1638
Item-75                  3         69       1638
Item-67                  2         68       1637
Item-55                  3         68       1638
Item-96                  2         68       1637
Item-25                  1         66       1638
Item-83                  3         65       1638
Item-78                  1         65       1638
Item-20                  2         64       1637
Item-1                   1         61       1638
Item-84                  3         61       1638
Item-59                  2         61       1637
Item-82                  2         60       1637
Item-16                  1         60       1638
Item-38                  3         58       1638
Item-28                  3         56       1638
Item-51                  1         55       1638
Item-81                  2         54       1637
Item-37                  2         54       1637
Item-19                  3         53       1638
Item-21                  1         51       1638
Item-58                  3         49       1638
Item-85                  1         49       1638
Item-5                   2         48       1637
Item-45                  1         47       1638
Item-14                  3         47       1638
Item-35                  2         47       1637
Item-10                  1         47       1638
Item-7                   3         46       1638
Item-50                  2         46       1637
Item-49                  1         45       1638
Item-3                   3         44       1638
Item-64                  2         44       1637
Item-15                  2         43       1637
Item-93                  3         40       1638
Item-43                  1         40       1638
Item-88                  3         39       1638
Item-66                  1         37       1638
Item-39                  2         36       1637
Item-31                  1         36       1638
Item-71                  1         35       1638
Item-97                  3         35       1638
Item-17                  2         35       1637
Item-72                  2         30       1637
Item-33                  3         30       1638
Item-30                  2         30       1637
Item-13                  3         28       1638
Item-56                  3         26       1638
Item-34                  1         26       1638
Item-60                  2         23       1637
Item-95                  1         19       1638
Item-54                  1         19       1638
Item-61                  2         17       1637
Item-94                  3         16       1638
Item-46                  2         15       1637
Item-87                  1         15       1638
Item-9                   3         14       1638
Item-57                  3         10       1638
Item-80                  1         10       1638
Item-79                  2          9       1637
Item-52                  1          9       1638
Item-26                  2          8       1637
Item-90                  3          8       1638
Item-98                  2          8       1637
Item-4                   3          6       1638
Item-44                  1          5       1638
Item-27                  3          5       1638
Item-69                  1          5       1638
Item-24                  1          4       1638
Item-48                  3          4       1638
Item-86                  2          4       1637
Item-2                   2          2       1637

99 rows selected.

Elapsed: 00:00:00.08
SQL_ID  gmsc0dm1u4bd8, child number 0
-------------------------------------
SELECT /*+ gather_plan_statistics XPLF */        item_name, bin,
item_value, Sum (item_value) OVER (PARTITION BY bin) bin_value   FROM
TABLE (Bin_Fit.Items_Binned (                      CURSOR (SELECT
item_name, item_value FROM items ORDER BY item_value DESC),
:N_BINS))  ORDER BY item_value DESC
Plan hash value: 3383417
-----------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                           | Name         | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
-----------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                    |              |      1 |        |     99 |00:00:00.01 |      56 |       |       |          |
|   1 |  SORT ORDER BY                      |              |      1 |   8168 |     99 |00:00:00.01 |      56 | 70656 | 70656 |63488  (0)|
|   2 |   WINDOW SORT                       |              |      1 |   8168 |     99 |00:00:00.01 |      56 |  9216 |  9216 | 8192  (0)|
|   3 |    COLLECTION ITERATOR PICKLER FETCH| ITEMS_BINNED |      1 |   8168 |     99 |00:00:00.01 |      56 |       |       |          |
|   4 |     SORT ORDER BY                   |              |      0 |     99 |      0 |00:00:00.01 |       0 | 73728 | 73728 |          |
|   5 |      TABLE ACCESS FULL              | ITEMS        |      0 |     99 |      0 |00:00:00.01 |       0 |       |       |          |
-----------------------------------------------------------------------------------------------------------------------------------------

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.12
RSF

ITEM_NAME              BIN ITEM_VALUE  BIN_VALUE
--------------- ---------- ---------- ----------
Item-42                  1         98         98
Item-76                  2         98         98
Item-12                  3         97         97
Item-41                  3         95        192
Item-91                  2         95        193
Item-74                  1         92        190
Item-8                   1         91        281
Item-77                  3         91        283
Item-11                  1         90        371
Item-23                  2         90        283
Item-32                  2         89        372
Item-6                   3         88        371
Item-99                  1         87        458
Item-53                  3         86        457
Item-62                  2         82        454
Item-68                  2         82        536
Item-63                  3         80        537
Item-70                  1         79        537
Item-18                  2         78        614
Item-73                  3         76        613
Item-22                  1         76        613
Item-29                  1         75        763
Item-89                  1         75        688
Item-47                  3         75        688
Item-40                  2         75        689
Item-65                  3         73        761
Item-36                  2         72        761
Item-92                  3         71        832
Item-75                  2         69        830
Item-67                  1         68        831
Item-55                  2         68        898
Item-96                  1         68        899
Item-25                  3         66        898
Item-78                  2         65        963
Item-83                  3         65        963
Item-20                  1         64        963
Item-1                   2         61       1024
Item-84                  3         61       1024
Item-59                  1         61       1024
Item-16                  2         60       1084
Item-82                  3         60       1084
Item-38                  1         58       1082
Item-28                  1         56       1138
Item-51                  2         55       1139
Item-81                  1         54       1192
Item-37                  3         54       1138
Item-19                  3         53       1191
Item-21                  2         51       1190
Item-58                  3         49       1240
Item-85                  2         49       1239
Item-5                   1         48       1240
Item-45                  2         47       1286
Item-14                  3         47       1287
Item-35                  1         47       1287
Item-10                  2         47       1333
Item-7                   1         46       1333
Item-50                  3         46       1333
Item-49                  2         45       1378
Item-64                  1         44       1377
Item-3                   3         44       1377
Item-15                  1         43       1420
Item-43                  2         40       1418
Item-93                  3         40       1417
Item-88                  3         39       1456
Item-66                  2         37       1455
Item-39                  1         36       1456
Item-31                  2         36       1491
Item-97                  3         35       1491
Item-71                  2         35       1526
Item-17                  1         35       1491
Item-33                  1         30       1521
Item-72                  3         30       1521
Item-30                  3         30       1551
Item-13                  1         28       1549
Item-34                  2         26       1552
Item-56                  1         26       1575
Item-60                  3         23       1574
Item-54                  2         19       1571
Item-95                  2         19       1590
Item-61                  3         17       1591
Item-94                  1         16       1591
Item-87                  2         15       1605
Item-46                  1         15       1606
Item-9                   3         14       1605
Item-57                  3         10       1615
Item-80                  2         10       1615
Item-79                  1          9       1615
Item-52                  2          9       1624
Item-90                  3          8       1623
Item-26                  1          8       1623
Item-98                  1          8       1631
Item-4                   3          6       1629
Item-44                  2          5       1629
Item-69                  3          5       1634
Item-27                  2          5       1634
Item-24                  3          4       1638
Item-86                  1          4       1635
Item-48                  2          4       1638
Item-2                   1          2       1637

99 rows selected.

Elapsed: 00:00:00.05
SQL_ID  gyzn7bwb1p2qw, child number 0
-------------------------------------
WITH bins AS (        SELECT LEVEL bin, :N_BINS n_bins FROM DUAL
CONNECT BY LEVEL <= :N_BINS ), items_desc AS (        SELECT item_name,
item_value, Row_Number () OVER (ORDER BY item_value DESC) rn
FROM items ), rsf (bin, item_name, item_value, bin_value, lev,
bin_rank, n_bins) AS ( SELECT b.bin,        i.item_name,
i.item_value,        i.item_value,        1,        b.n_bins - i.rn +
1,        b.n_bins   FROM bins b   JOIN items_desc i     ON i.rn =
b.bin  UNION ALL SELECT r.bin,        i.item_name,        i.item_value,
r.bin_value + i.item_value,        r.lev + 1,        Row_Number
() OVER (ORDER BY r.bin_value + i.item_value),        r.n_bins   FROM
rsf r   JOIN items_desc i     ON i.rn = r.bin_rank + r.lev * r.n_bins )
SELECT  /*+ gather_plan_statistics XRSF_D */        r.item_name,
r.bin, r.item_value, r.bin_value   FROM rsf r  ORDER BY item_value DESC
Plan hash value: 3503473905
-----------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                                  | Name  | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
-----------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                           |       |      1 |        |     99 |00:00:00.01 |      14 |       |       |          |
|   1 |  SORT ORDER BY                             |       |      1 |      2 |     99 |00:00:00.01 |      14 |  9216 |  9216 | 8192  (0)|
|   2 |   VIEW                                     |       |      1 |      2 |     99 |00:00:00.01 |      14 |       |       |          |
|   3 |    UNION ALL (RECURSIVE WITH) BREADTH FIRST|       |      1 |        |     99 |00:00:00.01 |      14 |  2048 |  2048 | 2048  (0)|
|*  4 |     HASH JOIN                              |       |      1 |      1 |      3 |00:00:00.01 |       7 |  2078K|  2078K|  922K (0)|
|   5 |      VIEW                                  |       |      1 |      1 |      3 |00:00:00.01 |       0 |       |       |          |
|   6 |       CONNECT BY WITHOUT FILTERING         |       |      1 |        |      3 |00:00:00.01 |       0 |  2048 |  2048 | 2048  (0)|
|   7 |        FAST DUAL                           |       |      1 |      1 |      1 |00:00:00.01 |       0 |       |       |          |
|   8 |      VIEW                                  |       |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
|   9 |       WINDOW SORT                          |       |      1 |     99 |     99 |00:00:00.01 |       7 |  9216 |  9216 | 8192  (0)|
|  10 |        TABLE ACCESS FULL                   | ITEMS |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
|  11 |     WINDOW SORT                            |       |     33 |      1 |     96 |00:00:00.01 |       7 |  2048 |  2048 | 2048  (0)|
|* 12 |      HASH JOIN                             |       |     33 |      1 |     96 |00:00:00.01 |       7 |  1265K|  1265K|  926K (0)|
|  13 |       RECURSIVE WITH PUMP                  |       |     33 |        |     99 |00:00:00.01 |       0 |       |       |          |
|  14 |       BUFFER SORT (REUSE)                  |       |     33 |        |   3267 |00:00:00.01 |       7 | 73728 | 73728 |          |
|  15 |        VIEW                                |       |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
|  16 |         WINDOW SORT                        |       |      1 |     99 |     99 |00:00:00.01 |       7 |  9216 |  9216 | 8192  (0)|
|  17 |          TABLE ACCESS FULL                 | ITEMS |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
-----------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
4 - access("I"."RN"="B"."BIN")
12 - access("I"."RN"="R"."BIN_RANK"+"R"."LEV"*"R"."N_BINS")

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.13
Insert into temp table items_desc_temp

99 rows created.

Elapsed: 00:00:00.01
SQL_ID  1fandzhqr8djq, child number 0
-------------------------------------
INSERT INTO items_desc_temp SELECT /*+ gather_plan_statistics XINS */
item_id, item_name, item_value, Row_Number () OVER (ORDER BY
item_value DESC) rn   FROM items
Plan hash value: 2685534282
---------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                | Name            | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
---------------------------------------------------------------------------------------------------------------------------------
|   0 | INSERT STATEMENT         |                 |      1 |        |      0 |00:00:00.01 |      27 |       |       |          |
|   1 |  LOAD TABLE CONVENTIONAL | ITEMS_DESC_TEMP |      1 |        |      0 |00:00:00.01 |      27 |       |       |          |
|   2 |   WINDOW SORT            |                 |      1 |     99 |     99 |00:00:00.01 |       6 |  9216 |  9216 | 8192  (0)|
|   3 |    TABLE ACCESS FULL     | ITEMS           |      1 |     99 |     99 |00:00:00.01 |       6 |       |       |          |
---------------------------------------------------------------------------------------------------------------------------------

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.11
RSF with temporary table

ITEM_NAME              BIN ITEM_VALUE  BIN_VALUE
--------------- ---------- ---------- ----------
Item-42                  1         98         98
Item-76                  2         98         98
Item-12                  3         97         97
Item-41                  3         95        192
Item-91                  2         95        193
Item-74                  1         92        190
Item-8                   1         91        281
Item-77                  3         91        283
Item-11                  1         90        371
Item-23                  2         90        283
Item-32                  2         89        372
Item-6                   3         88        371
Item-99                  1         87        458
Item-53                  3         86        457
Item-62                  2         82        454
Item-68                  2         82        536
Item-63                  3         80        537
Item-70                  1         79        537
Item-18                  2         78        614
Item-73                  3         76        613
Item-22                  1         76        613
Item-29                  1         75        763
Item-89                  1         75        688
Item-47                  3         75        688
Item-40                  2         75        689
Item-65                  3         73        761
Item-36                  2         72        761
Item-92                  3         71        832
Item-75                  2         69        830
Item-67                  1         68        831
Item-55                  2         68        898
Item-96                  1         68        899
Item-25                  3         66        898
Item-78                  2         65        963
Item-83                  3         65        963
Item-20                  1         64        963
Item-1                   2         61       1024
Item-84                  3         61       1024
Item-59                  1         61       1024
Item-16                  2         60       1084
Item-82                  3         60       1084
Item-38                  1         58       1082
Item-28                  1         56       1138
Item-51                  2         55       1139
Item-81                  1         54       1192
Item-37                  3         54       1138
Item-19                  3         53       1191
Item-21                  2         51       1190
Item-58                  3         49       1240
Item-85                  2         49       1239
Item-5                   1         48       1240
Item-45                  2         47       1286
Item-14                  3         47       1287
Item-35                  1         47       1287
Item-10                  2         47       1333
Item-7                   1         46       1333
Item-50                  3         46       1333
Item-49                  2         45       1378
Item-64                  1         44       1377
Item-3                   3         44       1377
Item-15                  1         43       1420
Item-43                  2         40       1418
Item-93                  3         40       1417
Item-88                  3         39       1456
Item-66                  2         37       1455
Item-39                  1         36       1456
Item-31                  2         36       1491
Item-97                  3         35       1491
Item-71                  2         35       1526
Item-17                  1         35       1491
Item-33                  1         30       1521
Item-72                  3         30       1521
Item-30                  3         30       1551
Item-13                  1         28       1549
Item-34                  2         26       1552
Item-56                  1         26       1575
Item-60                  3         23       1574
Item-54                  2         19       1571
Item-95                  2         19       1590
Item-61                  3         17       1591
Item-94                  1         16       1591
Item-87                  2         15       1605
Item-46                  1         15       1606
Item-9                   3         14       1605
Item-57                  3         10       1615
Item-80                  2         10       1615
Item-79                  1          9       1615
Item-52                  2          9       1624
Item-90                  3          8       1623
Item-26                  1          8       1623
Item-98                  1          8       1631
Item-4                   3          6       1629
Item-44                  2          5       1629
Item-69                  3          5       1634
Item-27                  2          5       1634
Item-24                  3          4       1638
Item-86                  1          4       1635
Item-48                  2          4       1638
Item-2                   1          2       1637

99 rows selected.

Elapsed: 00:00:00.10
SQL_ID  bgbfvhvghz862, child number 0
-------------------------------------
WITH bins AS (        SELECT LEVEL bin, :N_BINS n_bins FROM DUAL
CONNECT BY LEVEL <= :N_BINS ), rsf (bin, item_name, item_value,
bin_value, lev, bin_rank, n_bins) AS ( SELECT b.bin,
i.item_name,        i.item_value,        i.item_value,        1,
b.n_bins - i.rn + 1,        b.n_bins   FROM bins b   JOIN
items_desc_temp i     ON i.rn = b.bin  UNION ALL SELECT r.bin,
i.item_name,        i.item_value,        r.bin_value + i.item_value,
r.lev + 1,        Row_Number () OVER (ORDER BY r.bin_value +
i.item_value),        r.n_bins   FROM rsf r   JOIN items_desc_temp i
ON i.rn = r.bin_rank + r.lev * r.n_bins ) SELECT  /*+
gather_plan_statistics XRSF_T */        item_name, bin, item_value,
bin_value   FROM rsf  ORDER BY item_value DESC
Plan hash value: 3763153141
------------------------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                                  | Name               | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
------------------------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                           |                    |      1 |        |     99 |00:00:00.01 |      70 |       |       |          |
|   1 |  SORT ORDER BY                             |                    |      1 |      2 |     99 |00:00:00.01 |      70 |  9216 |  9216 | 8192  (0)|
|   2 |   VIEW                                     |                    |      1 |      2 |     99 |00:00:00.01 |      70 |       |       |          |
|   3 |    UNION ALL (RECURSIVE WITH) BREADTH FIRST|                    |      1 |        |     99 |00:00:00.01 |      70 |  2048 |  2048 | 2048  (0)|
|*  4 |     HASH JOIN                              |                    |      1 |      1 |      3 |00:00:00.01 |       3 |  1610K|  1610K|  644K (0)|
|   5 |      VIEW                                  |                    |      1 |      1 |      3 |00:00:00.01 |       0 |       |       |          |
|   6 |       CONNECT BY WITHOUT FILTERING         |                    |      1 |        |      3 |00:00:00.01 |       0 |  2048 |  2048 | 2048  (0)|
|   7 |        FAST DUAL                           |                    |      1 |      1 |      1 |00:00:00.01 |       0 |       |       |          |
|   8 |      TABLE ACCESS FULL                     | ITEMS_DESC_TEMP    |      1 |      1 |     99 |00:00:00.01 |       3 |       |       |          |
|   9 |     WINDOW SORT                            |                    |     33 |      1 |     96 |00:00:00.01 |      67 |  2048 |  2048 | 2048  (0)|
|  10 |      NESTED LOOPS                          |                    |     33 |      1 |     96 |00:00:00.01 |      67 |       |       |          |
|  11 |       RECURSIVE WITH PUMP                  |                    |     33 |        |     99 |00:00:00.01 |       0 |       |       |          |
|  12 |       TABLE ACCESS BY INDEX ROWID BATCHED  | ITEMS_DESC_TEMP    |     99 |      1 |     96 |00:00:00.01 |      67 |       |       |          |
|* 13 |        INDEX RANGE SCAN                    | ITEMS_DESC_TEMP_N1 |     99 |      1 |     96 |00:00:00.01 |      35 |       |       |          |
------------------------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
4 - access("I"."RN"="B"."BIN")
13 - access("I"."RN"="R"."BIN_RANK"+"R"."LEV"*"R"."N_BINS")
Note
-----
- dynamic statistics used: dynamic sampling (level=2)
- this is an adaptive plan

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.16
COMMIT to delete temp table items_desc_temp

Commit complete.

Elapsed: 00:00:00.00
MOD with both Stew Ashton changes: removing measure from rule, and inline view

ITEM_NAME              BIN ITEM_VALUE  BIN_VALUE
--------------- ---------- ---------- ----------
Item-42                  1         98       1638
Item-76                  2         98       1637
Item-12                  3         97       1638
Item-91                  1         95       1638
Item-41                  3         95       1638
Item-74                  2         92       1637
Item-77                  3         91       1638
Item-8                   2         91       1637
Item-11                  2         90       1637
Item-23                  1         90       1638
Item-32                  1         89       1638
Item-6                   3         88       1638
Item-99                  2         87       1637
Item-53                  3         86       1638
Item-68                  1         82       1638
Item-62                  1         82       1638
Item-63                  3         80       1638
Item-70                  2         79       1637
Item-18                  1         78       1638
Item-73                  3         76       1638
Item-22                  2         76       1637
Item-40                  1         75       1638
Item-47                  3         75       1638
Item-29                  2         75       1637
Item-89                  2         75       1637
Item-65                  3         73       1638
Item-36                  1         72       1638
Item-92                  1         71       1638
Item-75                  3         69       1638
Item-67                  2         68       1637
Item-55                  3         68       1638
Item-96                  2         68       1637
Item-25                  1         66       1638
Item-83                  3         65       1638
Item-78                  1         65       1638
Item-20                  2         64       1637
Item-1                   1         61       1638
Item-84                  3         61       1638
Item-59                  2         61       1637
Item-82                  2         60       1637
Item-16                  1         60       1638
Item-38                  3         58       1638
Item-28                  3         56       1638
Item-51                  1         55       1638
Item-81                  2         54       1637
Item-37                  2         54       1637
Item-19                  3         53       1638
Item-21                  1         51       1638
Item-58                  3         49       1638
Item-85                  1         49       1638
Item-5                   2         48       1637
Item-45                  1         47       1638
Item-14                  3         47       1638
Item-35                  2         47       1637
Item-10                  1         47       1638
Item-7                   3         46       1638
Item-50                  2         46       1637
Item-49                  1         45       1638
Item-3                   3         44       1638
Item-64                  2         44       1637
Item-15                  2         43       1637
Item-93                  3         40       1638
Item-43                  1         40       1638
Item-88                  3         39       1638
Item-66                  1         37       1638
Item-39                  2         36       1637
Item-31                  1         36       1638
Item-71                  1         35       1638
Item-97                  3         35       1638
Item-17                  2         35       1637
Item-72                  2         30       1637
Item-33                  3         30       1638
Item-30                  2         30       1637
Item-13                  3         28       1638
Item-56                  3         26       1638
Item-34                  1         26       1638
Item-60                  2         23       1637
Item-95                  1         19       1638
Item-54                  1         19       1638
Item-61                  2         17       1637
Item-94                  3         16       1638
Item-46                  2         15       1637
Item-87                  1         15       1638
Item-9                   3         14       1638
Item-57                  3         10       1638
Item-80                  1         10       1638
Item-79                  2          9       1637
Item-52                  1          9       1638
Item-26                  2          8       1637
Item-90                  3          8       1638
Item-98                  2          8       1637
Item-4                   3          6       1638
Item-44                  1          5       1638
Item-27                  3          5       1638
Item-69                  1          5       1638
Item-24                  1          4       1638
Item-48                  3          4       1638
Item-86                  2          4       1637
Item-2                   2          2       1637

99 rows selected.

Elapsed: 00:00:00.06
SQL_ID  45z3qkqnrvrv5, child number 0
-------------------------------------
SELECT /*+ gather_plan_statistics XMOD */        item_name, bin,
item_value, Max (bin_value) OVER (PARTITION BY bin) bin_value   FROM (
SELECT * FROM items   MODEL     DIMENSION BY (Row_Number() OVER (ORDER
BY item_value DESC) rn)     MEASURES (item_name,
item_value,               Row_Number() OVER (ORDER BY item_value DESC)
bin,               item_value bin_value,               Row_Number()
OVER (ORDER BY item_value DESC) rn_m,               0 min_bin,
Count(*) OVER () - :N_BINS - 1 n_iters     )     RULES
ITERATE(100000) UNTIL (ITERATION_NUMBER >= n_iters[1]) (
min_bin[1] = Min(rn_m) KEEP (DENSE_RANK FIRST ORDER BY bin_value)[rn <=
:N_BINS],       bin[ITERATION_NUMBER + :N_BINS + 1] = min_bin[1],
bin_value[min_bin[1]] = bin_value[CV()] + Nvl
(item_value[ITERATION_NUMBER + :N_BINS + 1], 0)     ) )  WHERE
item_name IS NOT NULL  ORDER BY item_value DESC
Plan hash value: 3793897966
---------------------------------------------------------------------------------------------------------------------
| Id  | Operation              | Name  | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
---------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT       |       |      1 |        |     99 |00:00:00.01 |       7 |       |       |          |
|   1 |  SORT ORDER BY         |       |      1 |     99 |     99 |00:00:00.01 |       7 | 70656 | 70656 |63488  (0)|
|   2 |   WINDOW SORT          |       |      1 |     99 |     99 |00:00:00.01 |       7 |  9216 |  9216 | 8192  (0)|
|*  3 |    VIEW                |       |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
|   4 |     SQL MODEL ORDERED  |       |      1 |     99 |     99 |00:00:00.01 |       7 |   860K|   860K|  516K (0)|
|   5 |      WINDOW SORT       |       |      1 |     99 |     99 |00:00:00.01 |       7 |  9216 |  9216 | 8192  (0)|
|   6 |       TABLE ACCESS FULL| ITEMS |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
---------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
3 - filter("ITEM_NAME" IS NOT NULL)

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.12

'END:'||TO_CHAR(SYSDATE,'DD-MON-YY
----------------------------------
End: 24-MAR-2020 11:38:04

