
Database             Time                 Version
-------------------- -------------------- ------------------------------
Start: ORCL          26-MAR-2020 11:47:58 Version 19.3.0.0.0


PL/SQL procedure successfully completed.


Table truncated.


99 rows created.


PL/SQL procedure successfully completed.

old   2:   :N_BINS := &1;
new   2:   :N_BINS := 3;

PL/SQL procedure successfully completed.

Running for N_BINS value of...

    N_BINS
----------
         3

Queries
POS 3 bins

ITEM_NAME              BIN ITEM_VALUE  BIN_TOTAL
--------------- ---------- ---------- ----------
Item-93                  2        100       1742
Item-60                  3         99       1707
Item-56                  2         97       1742
Item-78                  1         97       1668
Item-89                  3         96       1707
Item-31                  2         95       1742
Item-76                  1         95       1668
Item-4                   3         94       1707
Item-58                  1         94       1668
Item-1                   3         93       1707
Item-70                  2         93       1742
Item-47                  1         90       1668
Item-61                  2         89       1742
Item-98                  3         88       1707
Item-30                  2         87       1742
Item-40                  1         87       1668
Item-5                   3         86       1707
Item-41                  1         84       1668
Item-17                  2         81       1742
Item-97                  3         79       1707
Item-57                  1         79       1668
Item-36                  2         77       1742
Item-91                  3         76       1707
Item-37                  1         76       1668
Item-54                  3         75       1707
Item-90                  2         75       1742
Item-12                  2         74       1742
Item-48                  1         74       1668
Item-7                   3         71       1707
Item-3                   1         70       1668
Item-16                  3         70       1707
Item-42                  2         70       1742
Item-21                  2         69       1742
Item-63                  1         69       1668
Item-39                  3         68       1707
Item-82                  1         67       1668
Item-62                  3         66       1707
Item-22                  2         66       1742
Item-72                  2         65       1742
Item-92                  1         65       1668
Item-24                  3         64       1707
Item-85                  1         62       1668
Item-81                  3         62       1707
Item-65                  2         62       1742
Item-10                  1         60       1668
Item-80                  3         60       1707
Item-83                  2         60       1742
Item-71                  2         57       1742
Item-8                   1         57       1668
Item-35                  3         56       1707
Item-49                  1         55       1668
Item-11                  2         53       1742
Item-67                  3         51       1707
Item-46                  1         50       1668
Item-74                  2         49       1742
Item-96                  3         46       1707
Item-64                  1         45       1668
Item-69                  2         44       1742
Item-51                  3         43       1707
Item-84                  2         41       1742
Item-33                  1         41       1668
Item-2                   3         40       1707
Item-79                  2         39       1742
Item-26                  1         39       1668
Item-43                  3         37       1707
Item-94                  1         37       1668
Item-52                  2         35       1742
Item-18                  3         33       1707
Item-38                  1         33       1668
Item-95                  2         32       1742
Item-13                  3         31       1707
Item-75                  2         28       1742
Item-53                  1         28       1668
Item-45                  3         27       1707
Item-15                  2         25       1742
Item-28                  1         25       1668
Item-27                  3         24       1707
Item-50                  1         23       1668
Item-88                  2         21       1742
Item-20                  3         20       1707
Item-59                  1         19       1668
Item-77                  3         16       1707
Item-99                  2         16       1742
Item-29                  2         13       1742
Item-55                  1         13       1668
Item-19                  3         12       1707
Item-32                  1         12       1668
Item-14                  2         10       1742
Item-87                  1          9       1668
Item-44                  3          9       1707
Item-66                  2          9       1742
Item-86                  3          8       1707
Item-23                  2          7       1742
Item-68                  1          7       1668
Item-25                  3          4       1707
Item-34                  1          3       1668
Item-9                   3          3       1707
Item-73                  2          3       1742
Item-6                   1          3       1668

99 rows selected.

Elapsed: 00:00:00.06
SQL_ID  00s7w5kf0x4td, child number 0
-------------------------------------
WITH items_desc AS (        SELECT item_name, item_value,
Mod (Row_Number () OVER (ORDER BY item_value DESC), :N_BINS) + 1 bin
FROM items ) SELECT /*+ gather_plan_statistics XPOS */
item_name, bin, item_value, Sum (item_value) OVER (PARTITION BY bin)
bin_total   FROM items_desc  ORDER BY item_value DESC
Plan hash value: 3874413825
--------------------------------------------------------------------------------------------------------------------
| Id  | Operation             | Name  | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
--------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT      |       |      1 |        |     99 |00:00:00.01 |       7 |       |       |          |
|   1 |  SORT ORDER BY        |       |      1 |     99 |     99 |00:00:00.01 |       7 | 76800 | 76800 |67584  (0)|
|   2 |   WINDOW SORT         |       |      1 |     99 |     99 |00:00:00.01 |       7 |  9216 |  9216 | 8192  (0)|
|   3 |    VIEW               |       |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
|   4 |     WINDOW SORT       |       |      1 |     99 |     99 |00:00:00.01 |       7 | 11264 | 11264 |10240  (0)|
|   5 |      TABLE ACCESS FULL| ITEMS |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
--------------------------------------------------------------------------------------------------------------------

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.40
PLF Items_Binned

ITEM_NAME              BIN ITEM_VALUE  BIN_VALUE
--------------- ---------- ---------- ----------
Item-93                  1        100       1705
Item-60                  2         99       1705
Item-78                  3         97       1707
Item-56                  3         97       1707
Item-89                  2         96       1705
Item-31                  3         95       1707
Item-76                  1         95       1705
Item-4                   1         94       1705
Item-58                  2         94       1705
Item-1                   2         93       1705
Item-70                  1         93       1705
Item-47                  3         90       1707
Item-61                  3         89       1707
Item-98                  1         88       1705
Item-30                  3         87       1707
Item-40                  2         87       1705
Item-5                   2         86       1705
Item-41                  1         84       1705
Item-17                  1         81       1705
Item-57                  3         79       1707
Item-97                  2         79       1705
Item-36                  2         77       1705
Item-37                  1         76       1705
Item-91                  3         76       1707
Item-90                  3         75       1707
Item-54                  1         75       1705
Item-48                  2         74       1705
Item-12                  2         74       1705
Item-7                   3         71       1707
Item-16                  3         70       1707
Item-3                   1         70       1705
Item-42                  1         70       1705
Item-63                  2         69       1705
Item-21                  1         69       1705
Item-39                  3         68       1707
Item-82                  2         67       1705
Item-22                  3         66       1707
Item-62                  1         66       1705
Item-92                  2         65       1705
Item-72                  2         65       1705
Item-24                  3         64       1707
Item-85                  1         62       1705
Item-65                  1         62       1705
Item-81                  3         62       1707
Item-83                  1         60       1705
Item-10                  2         60       1705
Item-80                  2         60       1705
Item-71                  3         57       1707
Item-8                   3         57       1707
Item-35                  1         56       1705
Item-49                  2         55       1705
Item-11                  2         53       1705
Item-67                  3         51       1707
Item-46                  1         50       1705
Item-74                  1         49       1705
Item-96                  3         46       1707
Item-64                  2         45       1705
Item-69                  3         44       1707
Item-51                  2         43       1705
Item-33                  1         41       1705
Item-84                  1         41       1705
Item-2                   2         40       1705
Item-79                  3         39       1707
Item-26                  3         39       1707
Item-94                  1         37       1705
Item-43                  2         37       1705
Item-52                  2         35       1705
Item-38                  3         33       1707
Item-18                  1         33       1705
Item-95                  1         32       1705
Item-13                  3         31       1707
Item-75                  2         28       1705
Item-53                  2         28       1705
Item-45                  3         27       1707
Item-28                  1         25       1705
Item-15                  1         25       1705
Item-27                  2         24       1705
Item-50                  3         23       1707
Item-88                  2         21       1705
Item-20                  3         20       1707
Item-59                  1         19       1705
Item-77                  3         16       1707
Item-99                  1         16       1705
Item-29                  2         13       1705
Item-55                  2         13       1705
Item-32                  3         12       1707
Item-19                  1         12       1705
Item-14                  2         10       1705
Item-44                  1          9       1705
Item-87                  3          9       1707
Item-66                  1          9       1705
Item-86                  2          8       1705
Item-68                  3          7       1707
Item-23                  3          7       1707
Item-25                  2          4       1705
Item-6                   1          3       1705
Item-9                   2          3       1705
Item-73                  1          3       1705
Item-34                  3          3       1707

99 rows selected.

Elapsed: 00:00:00.07
SQL_ID  gmsc0dm1u4bd8, child number 0
-------------------------------------
SELECT /*+ gather_plan_statistics XPLF */        item_name, bin,
item_value, Sum (item_value) OVER (PARTITION BY bin) bin_value   FROM
TABLE (Bin_Fit.Items_Binned (                      CURSOR (SELECT
item_name, item_value FROM items ORDER BY item_value DESC),
:N_BINS))  ORDER BY item_value DESC
Plan hash value: 3383417
-----------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                           | Name         | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
-----------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                    |              |      1 |        |     99 |00:00:00.01 |     165 |       |       |          |
|   1 |  SORT ORDER BY                      |              |      1 |   8168 |     99 |00:00:00.01 |     165 |  9216 |  9216 | 8192  (0)|
|   2 |   WINDOW SORT                       |              |      1 |   8168 |     99 |00:00:00.01 |     165 |  9216 |  9216 | 8192  (0)|
|   3 |    COLLECTION ITERATOR PICKLER FETCH| ITEMS_BINNED |      1 |   8168 |     99 |00:00:00.01 |     165 |       |       |          |
|   4 |     SORT ORDER BY                   |              |      0 |     99 |      0 |00:00:00.01 |       0 | 73728 | 73728 |          |
|   5 |      TABLE ACCESS FULL              | ITEMS        |      0 |     99 |      0 |00:00:00.01 |       0 |       |       |          |
-----------------------------------------------------------------------------------------------------------------------------------------

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.10
RSF

ITEM_NAME              BIN ITEM_VALUE  BIN_VALUE
--------------- ---------- ---------- ----------
Item-93                  1        100        100
Item-60                  2         99         99
Item-78                  3         97         97
Item-56                  3         97        194
Item-89                  2         96        195
Item-76                  1         95        195
Item-31                  3         95        289
Item-58                  2         94        289
Item-4                   1         94        289
Item-1                   2         93        382
Item-70                  3         93        382
Item-47                  1         90        379
Item-61                  1         89        468
Item-98                  3         88        470
Item-40                  2         87        469
Item-30                  1         87        555
Item-5                   2         86        555
Item-41                  3         84        554
Item-17                  3         81        635
Item-97                  1         79        634
Item-57                  2         79        634
Item-36                  1         77        711
Item-91                  2         76        710
Item-37                  3         76        711
Item-90                  2         75        785
Item-54                  3         75        786
Item-48                  1         74        785
Item-12                  2         74        859
Item-7                   1         71        856
Item-3                   3         70        856
Item-42                  1         70        926
Item-16                  3         70        926
Item-63                  2         69        928
Item-21                  1         69        995
Item-39                  3         68        994
Item-82                  2         67        995
Item-22                  3         66       1060
Item-62                  2         66       1061
Item-92                  1         65       1060
Item-72                  3         65       1125
Item-24                  1         64       1124
Item-85                  2         62       1123
Item-81                  1         62       1186
Item-65                  2         62       1185
Item-83                  2         60       1245
Item-10                  3         60       1185
Item-80                  3         60       1245
Item-71                  1         57       1300
Item-8                   1         57       1243
Item-35                  2         56       1301
Item-49                  3         55       1300
Item-11                  1         53       1353
Item-67                  3         51       1351
Item-46                  2         50       1351
Item-74                  3         49       1400
Item-96                  2         46       1397
Item-64                  1         45       1398
Item-69                  2         44       1441
Item-51                  1         43       1441
Item-33                  3         41       1441
Item-84                  2         41       1482
Item-2                   3         40       1481
Item-79                  1         39       1519
Item-26                  1         39       1480
Item-43                  3         37       1518
Item-94                  2         37       1519
Item-52                  3         35       1553
Item-18                  2         33       1552
Item-38                  1         33       1552
Item-95                  2         32       1584
Item-13                  1         31       1583
Item-53                  3         28       1581
Item-75                  3         28       1609
Item-45                  1         27       1610
Item-28                  2         25       1609
Item-15                  3         25       1634
Item-27                  2         24       1633
Item-50                  1         23       1633
Item-88                  2         21       1654
Item-20                  1         20       1653
Item-59                  3         19       1653
Item-99                  1         16       1669
Item-77                  3         16       1669
Item-55                  2         13       1667
Item-29                  2         13       1680
Item-32                  3         12       1681
Item-19                  1         12       1681
Item-14                  2         10       1690
Item-44                  3          9       1690
Item-87                  1          9       1690
Item-66                  2          9       1699
Item-86                  1          8       1698
Item-23                  3          7       1704
Item-68                  3          7       1697
Item-25                  1          4       1702
Item-34                  3          3       1707
Item-6                   2          3       1702
Item-73                  1          3       1705
Item-9                   2          3       1705

99 rows selected.

Elapsed: 00:00:00.05
SQL_ID  gyzn7bwb1p2qw, child number 0
-------------------------------------
WITH bins AS (        SELECT LEVEL bin, :N_BINS n_bins FROM DUAL
CONNECT BY LEVEL <= :N_BINS ), items_desc AS (        SELECT item_name,
item_value, Row_Number () OVER (ORDER BY item_value DESC) rn
FROM items ), rsf (bin, item_name, item_value, bin_value, lev,
bin_rank, n_bins) AS ( SELECT b.bin,        i.item_name,
i.item_value,        i.item_value,        1,        b.n_bins - i.rn +
1,        b.n_bins   FROM bins b   JOIN items_desc i     ON i.rn =
b.bin  UNION ALL SELECT r.bin,        i.item_name,        i.item_value,
r.bin_value + i.item_value,        r.lev + 1,        Row_Number
() OVER (ORDER BY r.bin_value + i.item_value),        r.n_bins   FROM
rsf r   JOIN items_desc i     ON i.rn = r.bin_rank + r.lev * r.n_bins )
SELECT  /*+ gather_plan_statistics XRSF_D */        r.item_name,
r.bin, r.item_value, r.bin_value   FROM rsf r  ORDER BY item_value DESC
Plan hash value: 3503473905
-----------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                                  | Name  | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
-----------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                           |       |      1 |        |     99 |00:00:00.01 |      14 |       |       |          |
|   1 |  SORT ORDER BY                             |       |      1 |      2 |     99 |00:00:00.01 |      14 |  9216 |  9216 | 8192  (0)|
|   2 |   VIEW                                     |       |      1 |      2 |     99 |00:00:00.01 |      14 |       |       |          |
|   3 |    UNION ALL (RECURSIVE WITH) BREADTH FIRST|       |      1 |        |     99 |00:00:00.01 |      14 |  2048 |  2048 | 2048  (0)|
|*  4 |     HASH JOIN                              |       |      1 |      1 |      3 |00:00:00.01 |       7 |  2078K|  2078K|  930K (0)|
|   5 |      VIEW                                  |       |      1 |      1 |      3 |00:00:00.01 |       0 |       |       |          |
|   6 |       CONNECT BY WITHOUT FILTERING         |       |      1 |        |      3 |00:00:00.01 |       0 |  2048 |  2048 | 2048  (0)|
|   7 |        FAST DUAL                           |       |      1 |      1 |      1 |00:00:00.01 |       0 |       |       |          |
|   8 |      VIEW                                  |       |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
|   9 |       WINDOW SORT                          |       |      1 |     99 |     99 |00:00:00.01 |       7 | 11264 | 11264 |10240  (0)|
|  10 |        TABLE ACCESS FULL                   | ITEMS |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
|  11 |     WINDOW SORT                            |       |     33 |      1 |     96 |00:00:00.01 |       7 |  2048 |  2048 | 2048  (0)|
|* 12 |      HASH JOIN                             |       |     33 |      1 |     96 |00:00:00.01 |       7 |  1265K|  1265K|  939K (0)|
|  13 |       RECURSIVE WITH PUMP                  |       |     33 |        |     99 |00:00:00.01 |       0 |       |       |          |
|  14 |       BUFFER SORT (REUSE)                  |       |     33 |        |   3267 |00:00:00.01 |       7 | 73728 | 73728 |          |
|  15 |        VIEW                                |       |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
|  16 |         WINDOW SORT                        |       |      1 |     99 |     99 |00:00:00.01 |       7 | 11264 | 11264 |10240  (0)|
|  17 |          TABLE ACCESS FULL                 | ITEMS |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
-----------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
4 - access("I"."RN"="B"."BIN")
12 - access("I"."RN"="R"."BIN_RANK"+"R"."LEV"*"R"."N_BINS")

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.13
Insert into temp table items_desc_temp

99 rows created.

Elapsed: 00:00:00.00
SQL_ID  1fandzhqr8djq, child number 0
-------------------------------------
INSERT INTO items_desc_temp SELECT /*+ gather_plan_statistics XINS */
item_id, item_name, item_value, Row_Number () OVER (ORDER BY
item_value DESC) rn   FROM items
Plan hash value: 2685534282
---------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                | Name            | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
---------------------------------------------------------------------------------------------------------------------------------
|   0 | INSERT STATEMENT         |                 |      1 |        |      0 |00:00:00.01 |      27 |       |       |          |
|   1 |  LOAD TABLE CONVENTIONAL | ITEMS_DESC_TEMP |      1 |        |      0 |00:00:00.01 |      27 |       |       |          |
|   2 |   WINDOW SORT            |                 |      1 |     99 |     99 |00:00:00.01 |       6 | 11264 | 11264 |10240  (0)|
|   3 |    TABLE ACCESS FULL     | ITEMS           |      1 |     99 |     99 |00:00:00.01 |       6 |       |       |          |
---------------------------------------------------------------------------------------------------------------------------------

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.10
RSF with temporary table

ITEM_NAME              BIN ITEM_VALUE  BIN_VALUE
--------------- ---------- ---------- ----------
Item-93                  1        100        100
Item-60                  2         99         99
Item-78                  3         97         97
Item-56                  3         97        194
Item-89                  2         96        195
Item-76                  1         95        195
Item-31                  3         95        289
Item-58                  2         94        289
Item-4                   1         94        289
Item-1                   2         93        382
Item-70                  3         93        382
Item-47                  1         90        379
Item-61                  1         89        468
Item-98                  3         88        470
Item-40                  2         87        469
Item-30                  1         87        555
Item-5                   2         86        555
Item-41                  3         84        554
Item-17                  3         81        635
Item-97                  1         79        634
Item-57                  2         79        634
Item-36                  1         77        711
Item-91                  2         76        710
Item-37                  3         76        711
Item-90                  2         75        785
Item-54                  3         75        786
Item-48                  1         74        785
Item-12                  2         74        859
Item-7                   1         71        856
Item-3                   3         70        856
Item-42                  1         70        926
Item-16                  3         70        926
Item-63                  2         69        928
Item-21                  1         69        995
Item-39                  3         68        994
Item-82                  2         67        995
Item-22                  3         66       1060
Item-62                  2         66       1061
Item-92                  1         65       1060
Item-72                  3         65       1125
Item-24                  1         64       1124
Item-85                  2         62       1123
Item-81                  1         62       1186
Item-65                  2         62       1185
Item-83                  2         60       1245
Item-10                  3         60       1185
Item-80                  3         60       1245
Item-71                  1         57       1300
Item-8                   1         57       1243
Item-35                  2         56       1301
Item-49                  3         55       1300
Item-11                  1         53       1353
Item-67                  3         51       1351
Item-46                  2         50       1351
Item-74                  3         49       1400
Item-96                  2         46       1397
Item-64                  1         45       1398
Item-69                  2         44       1441
Item-51                  1         43       1441
Item-33                  3         41       1441
Item-84                  2         41       1482
Item-2                   3         40       1481
Item-79                  1         39       1519
Item-26                  1         39       1480
Item-43                  3         37       1518
Item-94                  2         37       1519
Item-52                  3         35       1553
Item-18                  2         33       1552
Item-38                  1         33       1552
Item-95                  2         32       1584
Item-13                  1         31       1583
Item-53                  3         28       1581
Item-75                  3         28       1609
Item-45                  1         27       1610
Item-28                  2         25       1609
Item-15                  3         25       1634
Item-27                  2         24       1633
Item-50                  1         23       1633
Item-88                  2         21       1654
Item-20                  1         20       1653
Item-59                  3         19       1653
Item-99                  1         16       1669
Item-77                  3         16       1669
Item-55                  2         13       1667
Item-29                  2         13       1680
Item-32                  3         12       1681
Item-19                  1         12       1681
Item-14                  2         10       1690
Item-44                  3          9       1690
Item-87                  1          9       1690
Item-66                  2          9       1699
Item-86                  1          8       1698
Item-23                  3          7       1704
Item-68                  3          7       1697
Item-25                  1          4       1702
Item-34                  3          3       1707
Item-6                   2          3       1702
Item-73                  1          3       1705
Item-9                   2          3       1705

99 rows selected.

Elapsed: 00:00:00.06
SQL_ID  bgbfvhvghz862, child number 0
-------------------------------------
WITH bins AS (        SELECT LEVEL bin, :N_BINS n_bins FROM DUAL
CONNECT BY LEVEL <= :N_BINS ), rsf (bin, item_name, item_value,
bin_value, lev, bin_rank, n_bins) AS ( SELECT b.bin,
i.item_name,        i.item_value,        i.item_value,        1,
b.n_bins - i.rn + 1,        b.n_bins   FROM bins b   JOIN
items_desc_temp i     ON i.rn = b.bin  UNION ALL SELECT r.bin,
i.item_name,        i.item_value,        r.bin_value + i.item_value,
r.lev + 1,        Row_Number () OVER (ORDER BY r.bin_value +
i.item_value),        r.n_bins   FROM rsf r   JOIN items_desc_temp i
ON i.rn = r.bin_rank + r.lev * r.n_bins ) SELECT  /*+
gather_plan_statistics XRSF_T */        item_name, bin, item_value,
bin_value   FROM rsf  ORDER BY item_value DESC
Plan hash value: 3763153141
------------------------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                                  | Name               | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
------------------------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                           |                    |      1 |        |     99 |00:00:00.01 |      70 |       |       |          |
|   1 |  SORT ORDER BY                             |                    |      1 |      2 |     99 |00:00:00.01 |      70 |  9216 |  9216 | 8192  (0)|
|   2 |   VIEW                                     |                    |      1 |      2 |     99 |00:00:00.01 |      70 |       |       |          |
|   3 |    UNION ALL (RECURSIVE WITH) BREADTH FIRST|                    |      1 |        |     99 |00:00:00.01 |      70 |  2048 |  2048 | 2048  (0)|
|*  4 |     HASH JOIN                              |                    |      1 |      1 |      3 |00:00:00.01 |       3 |  1610K|  1610K|  662K (0)|
|   5 |      VIEW                                  |                    |      1 |      1 |      3 |00:00:00.01 |       0 |       |       |          |
|   6 |       CONNECT BY WITHOUT FILTERING         |                    |      1 |        |      3 |00:00:00.01 |       0 |  2048 |  2048 | 2048  (0)|
|   7 |        FAST DUAL                           |                    |      1 |      1 |      1 |00:00:00.01 |       0 |       |       |          |
|   8 |      TABLE ACCESS FULL                     | ITEMS_DESC_TEMP    |      1 |      1 |     99 |00:00:00.01 |       3 |       |       |          |
|   9 |     WINDOW SORT                            |                    |     33 |      1 |     96 |00:00:00.01 |      67 |  2048 |  2048 | 2048  (0)|
|  10 |      NESTED LOOPS                          |                    |     33 |      1 |     96 |00:00:00.01 |      67 |       |       |          |
|  11 |       RECURSIVE WITH PUMP                  |                    |     33 |        |     99 |00:00:00.01 |       0 |       |       |          |
|  12 |       TABLE ACCESS BY INDEX ROWID BATCHED  | ITEMS_DESC_TEMP    |     99 |      1 |     96 |00:00:00.01 |      67 |       |       |          |
|* 13 |        INDEX RANGE SCAN                    | ITEMS_DESC_TEMP_N1 |     99 |      1 |     96 |00:00:00.01 |      35 |       |       |          |
------------------------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
4 - access("I"."RN"="B"."BIN")
13 - access("I"."RN"="R"."BIN_RANK"+"R"."LEV"*"R"."N_BINS")
Note
-----
- dynamic statistics used: dynamic sampling (level=2)
- this is an adaptive plan

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.14
COMMIT to delete temp table items_desc_temp

Commit complete.

Elapsed: 00:00:00.00
MOD with both Stew Ashton changes: removing measure from rule, and inline view

ITEM_NAME              BIN ITEM_VALUE  BIN_VALUE
--------------- ---------- ---------- ----------
Item-93                  1        100       1705
Item-60                  2         99       1705
Item-78                  3         97       1707
Item-56                  3         97       1707
Item-89                  2         96       1705
Item-31                  3         95       1707
Item-76                  1         95       1705
Item-4                   1         94       1705
Item-58                  2         94       1705
Item-1                   2         93       1705
Item-70                  1         93       1705
Item-47                  3         90       1707
Item-61                  3         89       1707
Item-98                  1         88       1705
Item-30                  3         87       1707
Item-40                  2         87       1705
Item-5                   2         86       1705
Item-41                  1         84       1705
Item-17                  1         81       1705
Item-57                  3         79       1707
Item-97                  2         79       1705
Item-36                  2         77       1705
Item-37                  1         76       1705
Item-91                  3         76       1707
Item-90                  3         75       1707
Item-54                  1         75       1705
Item-48                  2         74       1705
Item-12                  2         74       1705
Item-7                   3         71       1707
Item-16                  3         70       1707
Item-3                   1         70       1705
Item-42                  1         70       1705
Item-63                  2         69       1705
Item-21                  1         69       1705
Item-39                  3         68       1707
Item-82                  2         67       1705
Item-22                  3         66       1707
Item-62                  1         66       1705
Item-92                  2         65       1705
Item-72                  2         65       1705
Item-24                  3         64       1707
Item-85                  1         62       1705
Item-65                  1         62       1705
Item-81                  3         62       1707
Item-83                  1         60       1705
Item-10                  2         60       1705
Item-80                  2         60       1705
Item-71                  3         57       1707
Item-8                   3         57       1707
Item-35                  1         56       1705
Item-49                  2         55       1705
Item-11                  2         53       1705
Item-67                  3         51       1707
Item-46                  1         50       1705
Item-74                  1         49       1705
Item-96                  3         46       1707
Item-64                  2         45       1705
Item-69                  3         44       1707
Item-51                  2         43       1705
Item-33                  1         41       1705
Item-84                  1         41       1705
Item-2                   2         40       1705
Item-79                  3         39       1707
Item-26                  3         39       1707
Item-94                  1         37       1705
Item-43                  2         37       1705
Item-52                  2         35       1705
Item-38                  3         33       1707
Item-18                  1         33       1705
Item-95                  1         32       1705
Item-13                  3         31       1707
Item-75                  2         28       1705
Item-53                  2         28       1705
Item-45                  3         27       1707
Item-28                  1         25       1705
Item-15                  1         25       1705
Item-27                  2         24       1705
Item-50                  3         23       1707
Item-88                  2         21       1705
Item-20                  3         20       1707
Item-59                  1         19       1705
Item-77                  3         16       1707
Item-99                  1         16       1705
Item-29                  2         13       1705
Item-55                  2         13       1705
Item-32                  3         12       1707
Item-19                  1         12       1705
Item-14                  2         10       1705
Item-44                  1          9       1705
Item-87                  3          9       1707
Item-66                  1          9       1705
Item-86                  2          8       1705
Item-68                  3          7       1707
Item-23                  3          7       1707
Item-25                  2          4       1705
Item-6                   1          3       1705
Item-9                   2          3       1705
Item-73                  1          3       1705
Item-34                  3          3       1707

99 rows selected.

Elapsed: 00:00:00.06
SQL_ID  45z3qkqnrvrv5, child number 0
-------------------------------------
SELECT /*+ gather_plan_statistics XMOD */        item_name, bin,
item_value, Max (bin_value) OVER (PARTITION BY bin) bin_value   FROM (
SELECT * FROM items   MODEL     DIMENSION BY (Row_Number() OVER (ORDER
BY item_value DESC) rn)     MEASURES (item_name,
item_value,               Row_Number() OVER (ORDER BY item_value DESC)
bin,               item_value bin_value,               Row_Number()
OVER (ORDER BY item_value DESC) rn_m,               0 min_bin,
Count(*) OVER () - :N_BINS - 1 n_iters     )     RULES
ITERATE(100000) UNTIL (ITERATION_NUMBER >= n_iters[1]) (
min_bin[1] = Min(rn_m) KEEP (DENSE_RANK FIRST ORDER BY bin_value)[rn <=
:N_BINS],       bin[ITERATION_NUMBER + :N_BINS + 1] = min_bin[1],
bin_value[min_bin[1]] = bin_value[CV()] + Nvl
(item_value[ITERATION_NUMBER + :N_BINS + 1], 0)     ) )  WHERE
item_name IS NOT NULL  ORDER BY item_value DESC
Plan hash value: 3793897966
---------------------------------------------------------------------------------------------------------------------
| Id  | Operation              | Name  | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
---------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT       |       |      1 |        |     99 |00:00:00.01 |       7 |       |       |          |
|   1 |  SORT ORDER BY         |       |      1 |     99 |     99 |00:00:00.01 |       7 |  9216 |  9216 | 8192  (0)|
|   2 |   WINDOW SORT          |       |      1 |     99 |     99 |00:00:00.01 |       7 |  9216 |  9216 | 8192  (0)|
|*  3 |    VIEW                |       |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
|   4 |     SQL MODEL ORDERED  |       |      1 |     99 |     99 |00:00:00.01 |       7 |   860K|   860K|  514K (0)|
|   5 |      WINDOW SORT       |       |      1 |     99 |     99 |00:00:00.01 |       7 | 11264 | 11264 |10240  (0)|
|   6 |       TABLE ACCESS FULL| ITEMS |      1 |     99 |     99 |00:00:00.01 |       7 |       |       |          |
---------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
3 - filter("ITEM_NAME" IS NOT NULL)

PL/SQL procedure successfully completed.

Elapsed: 00:00:00.12

'END:'||TO_CHAR(SYSDATE,'DD-MON-YY
----------------------------------
End: 26-MAR-2020 11:47:59

